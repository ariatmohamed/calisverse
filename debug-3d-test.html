<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Viewer Debug Test</title>
    
    <!-- Single model-viewer import -->
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0f;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .model-viewer-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #1a1a2e;
            border-radius: 16px;
            margin: 20px 0;
        }
        
        .debug-info {
            background: #2a2a3e;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
        }
        
        .success { background: #22c55e; color: white; }
        .error { background: #ef4444; color: white; }
        .loading { background: #f59e0b; color: white; }
        
        /* Professional Loader Styles */
        .professional-loader {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(168, 85, 247, 0.05));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 20px;
            z-index: 10;
        }

        .loader-content {
            text-align: center;
            max-width: 200px;
        }

        .poster-preview img {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 12px;
            opacity: 0.8;
        }

        .skeleton-shimmer {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 16px 0;
        }

        .shimmer-bar {
            height: 8px;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 100%);
            background-size: 400px 100%;
            border-radius: 4px;
            animation: shimmer 2s infinite;
        }

        .shimmer-bar:nth-child(1) { width: 80%; }
        .shimmer-bar:nth-child(2) { width: 60%; }
        .shimmer-bar:nth-child(3) { width: 90%; }

        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: 200px 0; }
        }

        .loading-pill {
            background: rgba(139, 92, 246, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>3D Viewer Debug Test</h1>
        
        <div class="debug-info">
            <h3>Debug Console:</h3>
            <div id="debug-log"></div>
        </div>
        
        <h2>Test 1: Direct Model-Viewer</h2>
        <div class="model-viewer-container">
            <model-viewer
                id="direct-viewer"
                src="/models/pullup-bar-black.glb"
                poster="/images/pullup-bar-black-poster.jpg"
                alt="Pull-Up Bar 3D Model"
                reveal="auto"
                camera-controls
                touch-action="pan-y"
                interaction-prompt="auto"
                environment-image="neutral"
                exposure="1.1"
                shadow-intensity="0.6"
                min-camera-orbit="auto auto 1.5m"
                max-camera-orbit="auto auto 4m"
                camera-orbit="15deg 75deg 2.5m"
                loading="lazy"
                seamless-poster
                style="width: 100%; height: 100%; background: transparent;">
            </model-viewer>
        </div>
        
        <h2>Test 2: Standardized System</h2>
        <div class="model-viewer-container" data-product="pullup-bar" id="standardized-test">
            <!-- Standardized viewer loads here -->
        </div>
        
        <button onclick="testStandardizedSystem()">Load Standardized Viewer</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <script src="js/standardized-3d-viewer.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const statusClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'loading';
            logDiv.innerHTML += `<div class="status ${statusClass}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        function clearLog() {
            document.getElementById('debug-log').innerHTML = '';
        }
        
        function testStandardizedSystem() {
            log('Testing standardized 3D viewer system...', 'loading');
            
            // Check if class exists
            if (typeof Standardized3DViewer !== 'undefined') {
                log('‚úÖ Standardized3DViewer class found', 'success');
                
                // Check if instance exists
                if (window.standardized3DViewer) {
                    log('‚úÖ Global instance exists', 'success');
                } else {
                    log('‚ùå Global instance not found, creating new one...', 'error');
                    window.standardized3DViewer = new Standardized3DViewer();
                }
            } else {
                log('‚ùå Standardized3DViewer class not found', 'error');
            }
        }
        
        // Test direct model-viewer
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ Page loaded, starting tests...', 'loading');
            
            const directViewer = document.getElementById('direct-viewer');
            
            directViewer.addEventListener('load', () => {
                log('‚úÖ Direct model-viewer loaded successfully', 'success');
            });
            
            directViewer.addEventListener('error', (e) => {
                log(`‚ùå Direct model-viewer error: ${e.detail || e.message}`, 'error');
            });
            
            directViewer.addEventListener('model-visibility', () => {
                log('‚úÖ Direct model-viewer visible', 'success');
            });
            
            // Test model-viewer availability
            if (customElements.get('model-viewer')) {
                log('‚úÖ model-viewer custom element registered', 'success');
            } else {
                log('‚ùå model-viewer custom element not found', 'error');
            }
            
            // Test file accessibility
            fetch('/models/pullup-bar-black.glb', { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ Model file accessible', 'success');
                    } else {
                        log(`‚ùå Model file not accessible: ${response.status}`, 'error');
                    }
                })
                .catch(e => {
                    log(`‚ùå Model file fetch error: ${e.message}`, 'error');
                });
            
            fetch('/images/pullup-bar-black-poster.jpg', { method: 'HEAD' })
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ Poster image accessible', 'success');
                    } else {
                        log(`‚ùå Poster image not accessible: ${response.status}`, 'error');
                    }
                })
                .catch(e => {
                    log(`‚ùå Poster image fetch error: ${e.message}`, 'error');
                });
            
            // Auto-test standardized system after 2 seconds
            setTimeout(testStandardizedSystem, 2000);
        });
        
        // Global error handler
        window.addEventListener('error', (e) => {
            log(`‚ùå JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', (e) => {
            log(`‚ùå Unhandled Promise Rejection: ${e.reason}`, 'error');
        });
    </script>
</body>
</html>
